////////////////////////////////////////////////////////////////////////////////
/// Define the main configuration maps
/// @author Fábio Macêdo Mendes
/// @group Config
////////////////////////////////////////////////////////////////////////////////
@import 'font-stacks';
@import 'colors';
@import '../../fn';
@import '../mixins/utilities';

//------------------------------------------------------------------------------
// CONFIGURATION DICTIONARY
//------------------------------------------------------------------------------

/// Main configuration dictionary. You customize Mendeleev by setting values
/// to this dictionary.
$config: () !default;

/// Default configuration options.
/// This map contains all default values for configurations that can be
/// overridden by the `$config` or `$config-defaults` mappings.
$mendeleev-enabled: false !default;
$mendeleev-config: (
    //
    // GLOBAL
    'breakpoints': (
        'sm': 30rem,
        'md': 50rem,
        'lg': 75rem,
    ),
    'utilities': (
        'important': true,
        'emit': 'respect',
    ),
    //
    // TYPOGRAPHY
    'typography': (
        //
        // Generic
        'modules': (
            'headings': $mendeleev-enabled,
            'paragraph': $mendeleev-enabled,
            'scale': $mendeleev-enabled,
            'leading': $mendeleev-enabled,
            'measure': $mendeleev-enabled,
            'indent': $mendeleev-enabled,
            'alignment': $mendeleev-enabled,
            'styles': $mendeleev-enabled,
            'weights': $mendeleev-enabled,
            'fonts': $mendeleev-enabled,
            'direction': $mendeleev-enabled,
            'white-space': $mendeleev-enabled,
        ),
        //
        // Typefaces
        'typeface': $MENDELEEV_TYPEFACE,
        'cursive': $font-stack-system-cursive,
        'monospace': $font-stack-ibm-plex-mono,
        'sans-serif': $font-stack-exo,
        'serif': $font-stack-ibm-plex-serif,
        //
        // Vertical rhythm and modular scale
        'size': (
            'start': 16,
            'sm': 17,
            'md': 18,
            'lg': 20,
        ),
        'lead': 1.5,
        'heading-lead': 1.250,
        'scale': (
            'start': 9/8,
            'sm': (9/4 + 5/4) / 3,
            'md': (9/8 + 5/2) / 3,
            'lg': 5/4,
        ),
        //
        // Overridden properties
        'body': (),
        'paragraph': (),
        'headings': (
            'letter-spacing': -0.03em,
            'font-weight': 900,
            'color': $color-brand,
        ),
    ),
    //
    // COLORS
    'palette': $MENDELEEV_COLORS,
    'contrast': $MENDELEEV_CONTRAST,
    'color': (
        'contrast-bias': 0.125,
        'roles': (
            'simple': (
                'primary', 'secondary', 'action',
                'positive', 'negative', 'warning',
                'black', 'white', 'grey', 'red', 'orange', 'yellow', 'olive',
                'green', 'teal', 'blue', 'violet', 'purple', 'pink', 'brown',
            ),
            'variants': (
                'brand', 'accent',
            ),
            'text': (
                'inverse', 'muted',
            )
        ),
        'variants': (
            'color': (
                'lighter': ('white', 75%),
                'light': ('white', 33%),
                'dark': ('black', 33%),
                'darker': ('black', 75%),
            ),
            'text': (
                'light': ('light', 97.5%),
                'dark': ('dark', 97.5%),
            ),
        ),
    ),
    //
    // ANIMATIONS
    'animation': (
        'duration': 300ms,
        'timing-function': ease,
    ),
    //
    // FORM ITEMS
    'input': (
        'color-role': 'white',
        'border': 1px solid,
        'border-color': 'action',
        'border-radius': 0.25,
    ),
    'button': (
        'color-role': 'action',
        'border': 1px solid,
        'border-color': 'action',
        'border-radius': 0.25,
        'font-weight': bold,
    ),
    //
    // LAYOUT
    'layout': (
        'display': $mendeleev-enabled,
        'float': $mendeleev-enabled,
        'position': $mendeleev-enabled,
        'container': $mendeleev-enabled,
        'overflow': $mendeleev-enabled,
    ),
    //
    // OTHER MODULES
    'shadow': $mendeleev-enabled,
    'flex': $mendeleev-enabled,
    'flex-grid': $mendeleev-enabled,
    'grid': $mendeleev-enabled,
    'border': $mendeleev-enabled,
    'visibility': $mendeleev-enabled,
    'list': $mendeleev-enabled,
    'transform': $mendeleev-enabled,
    'background': $mendeleev-enabled,
    'interactivity': $mendeleev-enabled,
    'padding': $mendeleev-enabled,
    'margin':  $mendeleev-enabled,
    'sizes': $mendeleev-enabled,
    'sizing': $mendeleev-enabled,
    //
    // ELEMENT OVERRIDES
    'elements': (),
) !default;

$_config-not-given: unique-id() !default;

//------------------------------------------------------------------------------
// SETTING UP UTILITY CLASSES
//------------------------------------------------------------------------------

// Default dictionary with Mendeleev state.
$MENDELEEV_UTILITIES: null !default;

@function register-raw-utilities($map) {
    $MENDELEEV_UTILITIES: cons($map, $MENDELEEV_UTILITIES) !global;
    @return $map;
}

/// Register utility class
///
/// @arg $name - Class name
/// @arg $data - Map with the class content
/// @arg $emit - Set to false to avoid emitting code in the final stylesheet.
@function register-utility($name, $data, $emit: true, $type: map) {
    $info: (name: $name, data: $data, emit: $emit, type: $type);
    @if not contains(map responsive, $type) {
        @error 'Invalid type: #{$type}';
    }
    $do: register-raw-utilities($info);
    @return $info;
}

/// Register many utility classes
///
/// @arg $emit - Set to false to avoid emitting code in the final stylesheet.
/// @arg $data - Map with the class content
@function register-many-utilities($args...) {
    $emit: true;
    $spec: ();
    @if length($args) == 1 {
        $spec: nth($args, 1);
    } @else if length($args) == 2 {
        $emit: nth($args, 1);
        $spec: nth($args, 2);
    }
    @each $name, $data in $spec {
        $do: register-utility($name, $data, $emit: $emit)
    }
    @return $spec;
}

/// Register group of utility classes
///
/// @arg $property - Name of controlled property
/// @arg $categories - List of values or mapping from name to value
/// @arg $prefix - If given, will prefix the name of each class with this value
/// @arg $emit, $where - Same as register-utility
@function register-utilities($property, $categories, $prefix: '', $emit: true) {
    @if type-of($categories) == list {
        $categories: zip($categories, $categories);
    }
    @each $category, $value in $categories {
        $do: register-utility('#{$prefix}#{$category}', ($property: $value), $emit: $emit);
    }
    @return null;
}

/// Register many utility classes
///
/// @arg $emit - Set to false to avoid emitting code in the final stylesheet.
/// @arg $data - Map with the class content
@function register-many-templates($args...) {
    $emit: true;
    $spec: ();
    @if length($args) == 1 {
        $spec: nth($args, 1);
    } @else if length($args) == 2 {
        $emit: nth($args, 1);
        $spec: nth($args, 2);
    }
    @each $prop, $data in $spec {
        $prefix: nth($data, 1);
        $categories: nth($data, 2);
        $do: register-utilities($prop, $categories, $prefix, $emit: $emit)
    }
    @return $spec;
}

@function _bp-selector($bp, $name) {
    $name: str-slice($name, 2);
    @return '.#{$bp}\:#{$name}';
}
